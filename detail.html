<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Grande photo</title>
    <style>
      :root { color-scheme: light dark; }
      * { box-sizing: border-box; }
      html, body { height: 100%; }
      body {
        margin: 0;
        background: #000;
        color: #fff;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      }
      .wrap {
        position: relative;
        height: 100vh;
        width: 100vw;
        overflow: hidden;
      }
      .big {
        width: 100vw;
        height: 100vh;
        object-fit: contain; /* Voir toute la photo sans recadrage; changez en 'cover' si vous préférez remplir */
        display: block;
      }
      .back {
        position: fixed;
        top: 12px;
        left: 12px;
        padding: 0.5rem 0.75rem;
        background: rgba(255,255,255,0.1);
        color: #fff;
        text-decoration: none;
        border: 1px solid rgba(255,255,255,0.35);
        border-radius: 8px;
        backdrop-filter: blur(2px);
        z-index: 1000; /* au-dessus de l'image */
      }
    </style>
  </head>
  <body>
    <!-- Placez une image "grande" dans ce dossier et nommez-la: grande.jpg -->
    <a class="back" href="index.html" aria-label="Retour à la galerie">← Retour</a>
    <div class="wrap">
      <img class="big" src="grande.jpg" alt="Grande photo" />
    </div>
    <!-- Audio de continuation -->
    <audio id="celebrate" src="happy-birthday.wav" preload="auto"></audio>
    <script>
      (function () {
        const key = 'persistAudio';
        let data = null;
        try { data = JSON.parse(sessionStorage.getItem(key) || 'null'); } catch (_) { data = null; }
        if (!data) return;

        const audio = document.getElementById('celebrate');
        if (!audio) return;

        try { if (data.src) audio.src = data.src; } catch (_) {}
        try { if (typeof data.volume === 'number') audio.volume = data.volume; } catch (_) {}

        function startPlayback() {
          try {
            if (isFinite(audio.duration) && audio.duration > 0 && data.startedAt) {
              const elapsed = (Date.now() - data.startedAt) / 1000;
              const dur = audio.duration;
              const seekTo = Math.min(elapsed % dur, Math.max(0, dur - 0.25));
              if (isFinite(seekTo) && seekTo >= 0) audio.currentTime = seekTo;
            }
          } catch (_) {}

          const p = audio.play();
          if (p && typeof p.catch === 'function') {
            p.catch(() => showResumeButton());
          }
          try { sessionStorage.removeItem(key); } catch (_) {}
        }

        function showResumeButton() {
          const btn = document.createElement('button');
          btn.textContent = 'Reprendre la musique';
          Object.assign(btn.style, {
            position: 'fixed', left: '16px', bottom: '16px', right: 'auto', top: 'auto',
            padding: '0.6rem 0.9rem', borderRadius: '9999px',
            border: '1px solid rgba(255,255,255,0.35)',
            background: 'rgba(0,0,0,0.55)', color: '#fff',
            backdropFilter: 'blur(2px)', zIndex: 1001, cursor: 'pointer'
          });
          btn.addEventListener('click', () => {
            audio.play().then(() => btn.remove()).catch(() => {});
          });
          document.body.appendChild(btn);
        }

        if (audio.readyState >= 1) startPlayback();
        else audio.addEventListener('loadedmetadata', startPlayback, { once: true });
      })();
    </script>
  </body>
</html>
